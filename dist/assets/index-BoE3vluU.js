import{r as p,j as a,c as E,R as S}from"./vendor-DuOeAc5B.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();function h(s){const e=s.replace(/[×]/g,"*").replace(/[÷]/g,"/");return/[^0-9\.\+\-\*\/\(\)\s\%]/.test(e)?null:e}function k(s){const o=new Function("return "+s)();if(typeof o!="number"||Number.isNaN(o)||!Number.isFinite(o))throw new Error("Invalid calculation result");return o}async function C(s){const e=A();if(e)try{return await e(s)}catch{}return P(s)}function A(){const s=typeof localStorage<"u"&&localStorage.getItem("OPENAI_API_KEY")||void 0,e=typeof localStorage<"u"&&localStorage.getItem("GROQ_API_KEY")||void 0;return s?o=>I(o,s):e?o=>O(o,e):null}async function I(s,e){const o=`You convert math in natural language to a JS-safe arithmetic expression using + - * / % ( ).
No variables, only numbers and operators. No words. No equals. Example: "15% of 240 + 3^2" -> "240*0.15+3*3".
Input: ${s}
Output:`,n=(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You output only arithmetic expressions, nothing else."},{role:"user",content:o}],temperature:0})})).json()).choices?.[0]?.message?.content?.trim?.()||"",c=h(n);if(!c)throw new Error("Model returned invalid expression");return c}async function O(s,e){const o=`You convert math in natural language to a JS-safe arithmetic expression using + - * / % ( ).
No variables, only numbers and operators. No words. No equals. Example: "15% of 240 + 3^2" -> "240*0.15+3*3".
Input: ${s}
Output:`,n=(await(await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"llama-3.1-8b-instant",messages:[{role:"system",content:"You output only arithmetic expressions, nothing else."},{role:"user",content:o}],temperature:0})})).json()).choices?.[0]?.message?.content?.trim?.()||"",c=h(n);if(!c)throw new Error("Model returned invalid expression");return c}function P(s){let e=s.toLowerCase().trim();e=e.replace(/percent/g,"%"),e=e.replace(/(\d+(?:\.\d+)?)%\s+of\s+(\d+(?:\.\d+)?)/g,(l,r,n)=>`${n}*${Number(r)/100}`),e=e.replace(/(\d+)\s*(?:\^|to the power of)\s*(\d+)/g,(l,r,n)=>`${r}*`.repeat(Number(n)).slice(0,-1)),e=e.replace(/plus/g,"+").replace(/minus/g,"-").replace(/times|x|multiplied by/g,"*").replace(/divided by|over/g,"/"),e=e.replace(/[^0-9\.\+\-\*\/\(\)\s]/g,"");const o=h(e);if(!o)throw new Error("Could not parse input");try{k(o)}catch{throw new Error("Could not evaluate parsed expression")}return o}function L(s){const{history:e,onClearHistory:o}=s,[l,r]=p.useState(""),[n,c]=p.useState(!1),[x,m]=p.useState(null);async function v(y){if(y.preventDefault(),!!l.trim()){c(!0),m(null);try{const g=await C(l),w=new CustomEvent("nl-expression",{detail:g});window.dispatchEvent(w),r("")}catch(g){m(g?.message||"Failed to parse")}finally{c(!1)}}}return a.jsxs("div",{className:"w-full flex flex-col gap-2",children:[a.jsxs("form",{onSubmit:v,className:"flex items-center gap-2 w-full",children:[a.jsx("input",{"aria-label":"Ask AI",placeholder:"Ask: 15% of 240 + 3^2",className:"flex-1 rounded-lg px-3 py-2 bg-[var(--button-bg)] text-[var(--display-text-color)] outline-none",value:l,onChange:y=>r(y.target.value)}),a.jsx("button",{disabled:n,className:"rounded-lg px-3 py-2",style:{backgroundColor:"var(--action-bg)",color:"var(--action-text-color)"},children:n?"...":"Go"})]}),x&&a.jsx("div",{className:"text-sm text-red-400",children:x}),a.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-2 justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{children:["History: ",e.length]}),a.jsx("button",{type:"button",onClick:o,className:"underline",children:"Clear"})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("input",{placeholder:"OpenAI API key",className:"rounded px-2 py-1 bg-[var(--button-bg)] text-[var(--display-text-color)]",onChange:y=>localStorage.setItem("OPENAI_API_KEY",y.target.value)})})]})]})}const j=[{key:"AC",label:"AC",type:"action"},{key:"()",label:"( )",type:"parentheses"},{key:"%",label:"%",type:"operator"},{key:"/",label:"÷",type:"operator"},{key:"7",label:"7",type:"number"},{key:"8",label:"8",type:"number"},{key:"9",label:"9",type:"number"},{key:"*",label:"×",type:"operator"},{key:"4",label:"4",type:"number"},{key:"5",label:"5",type:"number"},{key:"6",label:"6",type:"number"},{key:"-",label:"-",type:"operator"},{key:"1",label:"1",type:"number"},{key:"2",label:"2",type:"number"},{key:"3",label:"3",type:"number"},{key:"+",label:"+",type:"operator"},{key:"0",label:"0",type:"number"},{key:".",label:".",type:"number"},{key:"backspace",label:"⌫",type:"action"},{key:"=",label:"=",type:"action"}];function z(){const[s,e]=p.useState(""),[o,l]=p.useState("0"),[r,n]=p.useState(()=>JSON.parse(localStorage.getItem("calculatorHistory")||"[]")),c=p.useRef(null),x=t=>{n(i=>{const u=[t,...i].slice(0,50);return localStorage.setItem("calculatorHistory",JSON.stringify(u)),u})},m=s||o,v=p.useMemo(()=>{const t=m.length;let i=3;return t>9&&(i=3*(9/t)),Math.max(i,1.5)},[m]);function y(t=10){"vibrate"in navigator&&navigator.vibrate(t)}function g(t){const i=(t.match(/\(/g)||[]).length,u=(t.match(/\)/g)||[]).length,d=t.slice(-1);return d===""||d==="("||["+","-","*","/","%"].includes(d)?t+"(":i>u?t+")":t+"*("}function w(t){switch(t){case"=":{if(!s)return;const i=h(s);if(i===null){l("Error"),e("");return}try{const u=k(i);x(`${s} = ${u}`),l(String(u)),e(""),y(20)}catch{l("Error"),e("")}return}case"AC":e(""),l("0");return;case"backspace":e(i=>i.slice(0,-1));return}}function N(t,i){y(),o==="Error"&&(l("0"),e("")),t.type==="number"||t.type==="operator"?e(u=>u==="0"&&t.key!=="."?t.key:u+t.key):t.type==="parentheses"?e(u=>g(u)):t.type==="action"&&w(t.key)}return p.useEffect(()=>{const t=i=>{const d={Enter:"=",Escape:"AC",Backspace:"backspace",0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",".":".","+":"+","-":"-","*":"*","/":"/","%":"%","(":"()",")":"()"}[i.key];if(!d)return;i.preventDefault();const f=j.find(b=>b.key===d);f&&N(f)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,o]),p.useEffect(()=>{const t=i=>{const d=i.detail;if(!d)return;const f=h(d);if(!f){l("Error"),e("");return}try{const b=k(f);x(`${f} = ${b}`),l(String(b)),e("")}catch{l("Error"),e("")}};return window.addEventListener("nl-expression",t),()=>window.removeEventListener("nl-expression",t)},[]),a.jsxs("div",{className:"calculator-body w-full h-full md:max-w-sm md:rounded-[40px] shadow-2xl flex flex-col p-4 md:p-6",role:"application","aria-label":"Calculator",style:{backgroundColor:"var(--calculator-bg)"},children:[a.jsx("div",{className:"flex justify-between items-center h-12 px-2 text-gray-400",children:a.jsx(L,{history:r,onClearHistory:()=>{n([]),localStorage.removeItem("calculatorHistory")}})}),a.jsxs("div",{className:"w-full text-right px-2 select-text flex-grow flex flex-col justify-end","aria-live":"polite",children:[a.jsx("div",{className:"h-8 text-lg md:text-xl",style:{color:"var(--sub-display-text-color)"}}),a.jsx("div",{ref:c,className:"font-bold break-words",style:{color:"var(--display-text-color)",fontSize:`${v}rem`},children:m})]}),a.jsx("div",{className:"pt-4",children:a.jsx("div",{className:"grid grid-cols-4 gap-3 md:gap-4",children:j.map(t=>a.jsx("button",{onClick:i=>N(t),className:"calc-button h-16 md:h-20 rounded-full text-2xl md:text-3xl","data-key":t.key,"data-type":t.type,style:{backgroundColor:t.type==="action"&&t.key!=="backspace"?"var(--action-bg)":"var(--button-bg)",color:t.type==="operator"?"var(--operator-text-color)":t.type==="action"&&t.key!=="backspace"?"var(--action-text-color)":"var(--button-text-color)"},children:t.label},t.key))})})]})}function $(){return a.jsx("div",{className:"min-h-screen bg-[var(--bg-color)] text-white flex items-center justify-center p-4",children:a.jsx(z,{})})}E.createRoot(document.getElementById("root")).render(a.jsx(S.StrictMode,{children:a.jsx($,{})}));
